<!DOCTYPE html>
<html>

<head>
  <title>Typing Practice</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="https://unpkg.com/mvp.css">
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="header">
    <div class="topbar">
      <h1>Typing Practice</h1>
      <p class="mt-1">Practice typing with the top 1000 most common words of a language</p>
    </div>
  </div>

  <section class="container">
    <aside class="main-content row" id="mainColumn">
      <p>
        <span id="word">Loading...</span>
      </p>
      <input placeholder="" autofocus id="enterText">
      <p id="message">&nbsp;</p>
    </aside>

    <aside class="row">
      <div class="row-flex">
        <div class="col col-25">
          <h4>Language</h4>
          <form id="languageForm">
            <!-- Using IETF BCP 47 language tags -->
            <div class="radio-item">
              <input type="radio" value="en" id="select-en" name="lang" checked />
              <label for="select-en">English</label>
            </div>
            <div class="radio-item">
              <input type="radio" value="es" id="select-es" name="lang"/>
              <label for="select-es">Spanish</label>
            </div>
          </form>
        </div>
        <div class="col col-75">
          <h4>Options</h4>
          <div>
            <input id="optionPlaySound" type="checkbox" checked>
            <label for="optionPlaySound">Play sound</label>
          </div>
          <div>
            <input id="optionCaseSensitive" type="checkbox" checked>
            <label for="optionCaseSensitive">Case sensitive</label>
          </div>
        </div>
      </div>
    </aside>
  </section>

  <script src="words.js"></script>
  <script>
    const enterText = document.getElementById('enterText');
    const message = document.getElementById('message');
    const wordElement = document.getElementById('word');
    let currentWord = '';

    const correctSound = new Audio('https://thumbs.dreamstime.com/audiothumb_13752/137523215.mp3');
    correctSound.playbackRate = 1.5;
    correctSound.volume = 0.3;

    let lang = document.querySelector('input[name="lang"]:checked').value;
    let currentWordList;
    let soundEnabled = document.getElementById('optionPlaySound').checked;
    let caseSensitive = document.getElementById('optionPlaySound').checked;

    function newWord() {
      const newWord = currentWordList[Math.floor(Math.random() * currentWordList.length)];
      currentWord = newWord;
      wordElement.textContent = newWord;
    }

    enterText.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        e.preventDefault();
        if (e.ctrlKey) {
          newWord();
          e.target.value = '';
          message.textContent = '\u00A0';
        } else {
          validate(e);
        }
      }
    });

    function validate(e) {
      let inputText = e.target.value.trim();
      if (!caseSensitive) inputText = inputText.toLowerCase();

      if (inputText === currentWord) {
        message.textContent = '\u00A0';
        correctSound.currentTime = 0.01;
        soundEnabled && correctSound.play();
        e.target.value = '';
        newWord();
      } else {
        message.textContent = 'Incorrect';
      }
    }

    document.getElementById('optionPlaySound').addEventListener('change', (e) => {
      soundEnabled = e.target.checked;
    });

    document.getElementById('optionCaseSensitive').addEventListener('change', (e) => {
      caseSensitive = e.target.checked;
    });

    document.getElementById('languageForm').addEventListener('change', initialize);

    function initialize() {
      lang = document.querySelector('input[name="lang"]:checked').value;
      currentWordList = words[lang];
      newWord();
    }

    initialize();

  </script>
</body>

</html>